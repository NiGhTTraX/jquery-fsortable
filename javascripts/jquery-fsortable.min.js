/* jquery-fsortable v1.0.1
(c) 2014, Andrei Picus
License: GPL */
$.widget("ntx.fsortable",$.ui.sortable,{options:{emptyClass:"fsortable-empty",existingSortable:!1},_refresh:function(){var a=$("."+this.options.emptyClass,this.element),b=$(this.options.items,this.element).not(a);this._occupied=b.length,this._capacity=a.length,this._size=this._occupied+this._capacity,this._capacity?this.element.removeClass("full"):this.element.addClass("full")},_getFreeSpot:function(a){var b;return a&&a.placeholder[0]?(b=a.placeholder.nextAll("."+this.options.emptyClass+":first"),b.length||(b=a.placeholder.prevAll("."+this.options.emptyClass+":first"))):b=$("."+this.options.emptyClass+":last",this.element),b.length?b:null},_removeFreeSpot:function(a){var b=a||this;b._spot.remove(),b._spot=null,b.element.sortable("refresh"),b._capacity--,b._occupied++,0===b._capacity&&b.element.addClass("full")},_create:function(){var a=this;this.element.addClass("fsortable"),this.options.existingSortable?(this.options.cancel=this.element.sortable("option","cancel"),this.options.cancel+=", ."+this.options.emptyClass,this.element.sortable("option",this.options)):(this.options.cancel+=", ."+this.options.emptyClass,this.element.sortable(this.options)),this._refresh(),this._outside=!1,this._connected=!1,this.element.on("sortactivate",function(b,c){c.sender&&c.sender[0]===this||(a._outside=!0)}),this.element.on("sortdeactivate",function(){a._outside=!1,a._spot&&(a._connected?(a._spot.remove(),a._capacity--,a._occupied++):a._spot.show(),a._spot=null),a._connected=!1}),this.element.on("sortover",function(b,c){a._spot||a._outside===!0&&(a._spot=a._getFreeSpot(c),$(this).one("sortchange.fs",function(){a._spot.hide()}))}),this.element.on("sortreceive",function(){a._spot&&a._removeFreeSpot()}),this.element.on("sortout",function(b,c){$(this).off("sortchange.fs"),a.previous=c.placeholder.next(),a.previous.length||(a.previous=null)}),$(document).on("sortover",".ui-sortable",function(b,c){if(this!==a.element[0]&&c.sender&&c.sender[0]===a.element[0]){var d=c.sender.data(a.widgetFullName),e=$("<div></div>").addClass(a.options.emptyClass);d.previous?e.insertBefore(d.previous):e.appendTo(d.element),c.sender.sortable("refresh"),d._connected||(d._capacity++,d._occupied--),d._outside=!0,d._connected=!0,d._spot&&(d._spot.remove(),d._spot=null),d.element.removeClass("full")}})},_destroy:function(){this.element.removeClass("fsortable full"),this.options.existingSortable||this.element.sortable("destroy")},refresh:function(){this._refresh(),this.element.sortable("refresh")},size:function(){return this._size},capacity:function(){return this._capacity},occupied:function(){return this._occupied}});